"use client";

import React, { useState } from "react";
import { toast } from "sonner";

import useMutation from "@/core/hooks/useMutation";
import { updatePentestSetting } from "@/core/server/account/pentest/updatePentestSetting";
import { Pentestsettings } from "@prisma/client";

const PentestSetting = ({
  pentestSetting,
}: {
  pentestSetting: Pentestsettings;
}) => {
  const [selectedBot, setSelectedBot] = useState(pentestSetting.selectedBot);
  const [selectedScanMode, setSelectedScanMode] = useState(
    pentestSetting.selectedScanMode
  );

  const handleBotChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    // @ts-expect-error
    setSelectedBot(e.target.value);
  };

  const handleScanModeChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    // @ts-expect-error
    setSelectedScanMode(e.target.value);
  };
  const { mutate, isPending } = useMutation(updatePentestSetting);
  const sendData = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    const { success, error } = await mutate({
      id: pentestSetting.id,
      selectedBot,
      selectedScanMode,
    });
    if (success) toast.success(success);
    else toast(error);
  };

  return (
    <section
      id="pentest-settings"
      className="flex flex-col justify-between p-5"
    >
      <h2 className="mb-2 p-2 py-2 text-2xl font-semibold text-gray-700">
        Pentest Setting
      </h2>
      <div className="rounded-3xl dark:bg-gray-800 p-5 shadow-sm">
        <form onSubmit={sendData}>
          <div className="w-full ">
            <div>
              <h3 className="text-2xl font-bold text-gray-900 dark:text-white">
                Choose Your Pentest Bot
              </h3>
              <p className="max-w-3xl py-2 text-sm text-slate-400">
                We need small information before you proceed with the Pentest
                request this help in personalization the user experience and
                perform better test.
              </p>

              <div className="my-2 flex items-center cursor-pointer rounded-3xl border-2 pl-5 ">
                <input
                  id="Voltbot"
                  type="radio"
                  value="VOLTBOT"
                  name="pentest-bot"
                  checked={selectedBot === "VOLTBOT"}
                  onChange={handleBotChange}
                  className="h-5 w-5 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-600"
                />
                <label
                  htmlFor="Voltbot"
                  className="ml-2 w-full cursor-pointer py-4 text-sm font-medium  text-gray-900 dark:text-gray-300"
                >
                  VoltBot (Default) - &quot;Best For Balanced Testing&quot;
                </label>
              </div>
              <div className="my-2 flex items-center cursor-pointer rounded-3xl border-2 pl-5 ">
                <input
                  id="Hackwing"
                  type="radio"
                  value="HACKWING"
                  name="pentest-bot"
                  checked={selectedBot === "HACKWING"}
                  onChange={handleBotChange}
                  className="h-5 w-5 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-600"
                />
                <label
                  htmlFor="Hackwing"
                  className="ml-2 w-full cursor-pointer py-4 text-sm font-medium  text-gray-900 dark:text-gray-300"
                >
                  Hackwing (Advance Mode - &quot;Unstable&quot;) - &quot;Best
                  For Deep Testing&quot;
                </label>
              </div>
            </div>

            <div className="relative w-full  transition duration-200 ">
              <h3 className="text-2xl font-bold text-gray-900 dark:text-white">
                Select Your Scan Mode
              </h3>

              <ul className="grid w-full gap-6 py-5 md:grid-cols-3">
                <li>
                  <input
                    type="radio"
                    id="LightScan"
                    name="scan-mode"
                    value="LIGHTSCAN"
                    checked={selectedScanMode === "LIGHTSCAN"}
                    onChange={handleScanModeChange}
                    required
                    className="peer hidden"
                  />
                  <label
                    htmlFor="LightScan"
                    className="inline-flex w-full cursor-pointer items-center justify-between rounded-3xl border border-gray-200 bg-white p-5 text-gray-500 hover:bg-gray-100 hover:text-gray-600 peer-checked:border-blue-600 peer-checked:text-blue-600 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 dark:peer-checked:text-blue-500"
                  >
                    <div className="block">
                      <div className="w-full text-lg font-semibold">
                        Light Scan
                      </div>
                      <div className="w-full">
                        Quick Testing on UI & UX on each Layer
                      </div>
                    </div>
                    <svg
                      aria-hidden="true"
                      className="ml-3 h-6 w-6"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fillRule="evenodd"
                        d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"
                        clipRule="evenodd"
                      ></path>
                    </svg>
                  </label>
                </li>
                <li>
                  <input
                    type="radio"
                    id="DeepScan"
                    name="scan-mode"
                    value="DEEPSCAN"
                    checked={selectedScanMode === "DEEPSCAN"}
                    onChange={handleScanModeChange}
                    className="peer hidden"
                  />
                  <label
                    htmlFor="DeepScan"
                    className="inline-flex w-full cursor-pointer items-center justify-between rounded-3xl border border-gray-200 bg-white p-5 text-gray-500 hover:bg-gray-100 hover:text-gray-600 peer-checked:border-blue-600 peer-checked:text-blue-600 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 dark:peer-checked:text-blue-500"
                  >
                    <div className="block">
                      <div className="w-full text-lg font-semibold">
                        Deep Scan
                      </div>
                      <div className="w-full">
                        Deep BlackBox Testing On Each Layer
                      </div>
                    </div>
                    <svg
                      aria-hidden="true"
                      className="ml-3 h-6 w-6"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fillRule="evenodd"
                        d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"
                        clipRule="evenodd"
                      ></path>
                    </svg>
                  </label>
                </li>
                <li>
                  <input
                    type="radio"
                    id="BalancedScan"
                    name="scan-mode"
                    value="BALANCESCAN"
                    checked={selectedScanMode === "BALANCESCAN"}
                    onChange={handleScanModeChange}
                    className="peer hidden"
                  />
                  <label
                    htmlFor="BalancedScan"
                    className="inline-flex w-full cursor-pointer items-center justify-between rounded-3xl border border-gray-200 bg-white p-5 text-gray-500 hover:bg-gray-100 hover:text-gray-600 peer-checked:border-blue-600 peer-checked:text-blue-600 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 dark:peer-checked:text-blue-500"
                  >
                    <div className="block">
                      <div className="w-full text-lg font-semibold">
                        Balanced Scan
                      </div>
                      <div className="w-full">
                        {" "}
                        Balanced Test Layers At Fast Mode
                      </div>
                    </div>
                    <svg
                      aria-hidden="true"
                      className="ml-3 h-6 w-6"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fillRule="evenodd"
                        d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"
                        clipRule="evenodd"
                      ></path>
                    </svg>
                  </label>
                </li>
              </ul>
              <div className="items-center justify-between space-y-4 pt-0 sm:flex sm:space-y-0">
                <div className="items-center space-y-4 sm:flex sm:space-x-4 sm:space-y-0">
                  <button
                    id="confirm-button"
                    disabled={isPending}
                    type="submit"
                    className="inline-flex items-center rounded-3xl bg-[#3b83f652] text-blue-400 px-5 py-2 text-center text-lg font-medium  hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"
                  >
                    {!isPending ? "Update" : "Updating..."}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>
  );
};

export default PentestSetting;
